<!-- <!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Socket io client</title>
   <!-- <script src="http://localhost:3000/socket.io/socket.io.js"></script>
   <script src="https://unpkg.com/@plant/plant@2.4.0/dist/plant.js"></script>
   <script src="require.min.js" data-main="index.js"></script>
</head>
<body>
   
</body>
</html> -->
<!-- 
<!DOCTYPE html>
<meta charset="utf-8" />
<title>WebSocket Test</title>
<script language="javascript" type="text/javascript">
   var wsUri = "wss://echo.websocket.org/";
   // var wsUri = 'ws://achex.ca:4010';
   var output;

   function init() {
      output = document.getElementById("output");
      testWebSocket();
   }

   function testWebSocket() {
      websocket = new WebSocket(wsUri);
      websocket.onopen = function (evt) {
         onOpen(evt)
      };
      websocket.onclose = function (evt) {
         onClose(evt)
      };
      websocket.onmessage = function (evt) {
         onMessage(evt)
      };
      websocket.onerror = function (evt) {
         onError(evt)
      };
      document.addEventListener("keyup", (e)=>{
      console.log("listener OK");
      if(e.keyCode === 13){
         websocket.send(document.querySelector("#inputTest").value)
         document.querySelector("#inputTest").value = "";
         // onMessage(document.querySelector("#inputTest").value);
      }
   })
   }

   function onOpen(evt) {
      writeToScreen("CONNECTED");
      doSend("WebSocket rocks");
   }

   function onClose(evt) {
      writeToScreen("DISCONNECTED");
   }

   function onMessage(evt) {
      console.log("onMessage", evt)
      writeToScreen('<span style="color: blue;">RESPONSE: ' + evt.data + '</span>');
      // websocket.close();
   }

   function onError(evt) {
      writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data);
   }

   function doSend(message) {
      writeToScreen("SENT: " + message);
      websocket.send(message);
   }

   function writeToScreen(message) {
      var pre = document.createElement("p");
      pre.style.wordWrap = "break-word";
      pre.innerHTML = message;
      output.appendChild(pre);
   }

   window.addEventListener("load", init, false);
</script>

<h2>WebSocket Test</h2>
   <input id ="inputTest"type="text">

<div id="output"></div> -->

<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Document</title>
</head>
<body>
   <script>
      var ws;
      function IniciarConexion(){
         ws = new WebSocket("ws://achex.ca:4010");
         ws.onopen = function(){
            alert("conexion abierta");

            ws.send('{"setID":"MichatRoom", "passwd":"12345"}');
         }
         ws.onmessage = function(Mensajes){
            var MensajesObtenidos = Mensajes.data
            //alert("Mensajes obtenidos: " + MensajesObtenidos)
            // var x = document.createElement("p")
            var mensaje = JSON.parse(MensajesObtenidos);
            document.body.append(`<p>${mensaje.content}</p>`)
         }
         ws.onclose = function(){
            alert("COnexion cerrada")
         }
      }

   </script>


   <div>
      <input type="button" value="Iniciar WebSocket" onclick="IniciarConexion()">
      <input type="text" id="Mensaje">
      <input type="button" id="buttonId" value="Enviar Mensaje">
   </div>

   <script>
      document.querySelector("#buttonId").addEventListener("click", function(){
         // ws.send(document.querySelector("#Mensaje").value)
         ws.send(`{"to":"MichatRoom", "NombreU":"Oscar", "content":"${document.querySelector("#Mensaje").value}"}`);
      })
   </script>

</body>
</html>